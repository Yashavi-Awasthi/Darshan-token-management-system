<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üõï Live Darshan Display</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Mukta:wght@600;800&display=swap" rel="stylesheet">

<style>
:root{
  --saffron:#ff9933;
  --gold:#ffd700;
  --cream:#fff4dc;
}

*{box-sizing:border-box}

body{
  margin:0;
  min-height:100vh;
  font-family:Poppins,sans-serif;
  background:
    linear-gradient(rgba(40,10,0,.75),rgba(40,10,0,.85)),
    url("https://images.unsplash.com/photo-1548013146-72479768bada");
  background-size:cover;
  background-position:center;
  color:white;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:40px;
}

header{
  text-align:center;
  margin-bottom:35px;
}

header h1{
  font-family:Mukta,sans-serif;
  font-size:3.2rem;
  color:var(--gold);
}

header p{
  margin-top:8px;
  font-size:1.2rem;
  color:#f3e7d3;
}

select{
  font-size:22px;
  padding:14px 24px;
  border-radius:14px;
  border:none;
  font-weight:600;
  background:var(--cream);
  color:#5a1c00;
  margin-bottom:35px;
}

.display-card{
  background:rgba(255,245,225,.1);
  border:3px solid rgba(255,215,0,.5);
  border-radius:32px;
  padding:45px 60px;
  min-width:480px;
  text-align:center;
  backdrop-filter:blur(6px);
}

#mandirName{
  font-size:2.3rem;
  font-weight:700;
  color:var(--saffron);
  margin-bottom:20px;
}

#batchRange{
  font-size:6.2rem;
  font-weight:800;
  color:var(--gold);
}

#status{
  font-size:1.6rem;
  margin-top:15px;
  color:#c8ffb0;
}

footer{
  position:fixed;
  bottom:18px;
  font-size:1rem;
  color:#e7dcc6;
}
</style>
</head>

<body>

<header>
  <h1>üõï Live Darshan Display</h1>
  <p>Current Batch Inside Mandir</p>
</header>

<select id="mandirSelect">
  <option value="">Select Mandir</option>
</select>

<div class="display-card">
  <div id="mandirName"></div>
  <div id="batchRange">--</div>
  <div id="status">Waiting‚Ä¶</div>
</div>

<footer>
  üôè Smart Darshan Queue Management System
</footer>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBeTQdKmRH788wMrQh4x-IkEt6lt4_rd4E",
  databaseURL: "https://darshan-app-48a19-default-rtdb.firebaseio.com"
});

const db = firebase.database();

const mandirSelect = document.getElementById("mandirSelect");
const mandirName = document.getElementById("mandirName");
const batchRange = document.getElementById("batchRange");
const status = document.getElementById("status");

let templeId = "";
let batchSize = 0;

/* Load mandirs */
db.ref("mandirs").on("value", snap=>{
  mandirSelect.innerHTML = '<option value="">Select Mandir</option>';
  snap.forEach(c=>{
    mandirSelect.innerHTML +=
      `<option value="${c.key}">${c.val().mandirName}</option>`;
  });
});

/* Mandir selected */
mandirSelect.addEventListener("change", e=>{
  templeId = e.target.value;
  if(!templeId) return;

  db.ref("mandirs/"+templeId+"/mandirName")
    .once("value")
    .then(s=> mandirName.innerText = "üõï " + s.val());

  db.ref("batchSettings/"+templeId)
    .once("value")
    .then(s=>{
      batchSize = s.val().peoplePerBatch;
      listenLiveBatch();
    });
});

/* üî• CORE SYNC ‚Äî ONLY EXIT.HTML CONTROLS THIS */
function listenLiveBatch(){
  db.ref("nextBatch/"+templeId).on("value", snap=>{
    const data = snap.val();

    if(!data || !data.currentBatchStart){
      batchRange.innerText = "--";
      status.innerText = "‚è≥ Waiting for Batch";
      return;
    }

    const start = data.currentBatchStart;
    const end = start + batchSize - 1;

    batchRange.innerText = `${start} ‚Äì ${end}`;
    status.innerText = data.batchStart
      ? "üôè Devotees Inside Mandir"
      : "‚è≥ Waiting for Entry";
  });
}
</script>

</body>
</html>

